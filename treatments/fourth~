from openalea.plantgl.all import *
from math import * 

module Leaf

length = 2   # in some units (= cm for example)
dl = 0.1
scaling = 5   # to dilate/contract the leaf
midrib_separation = 13

phi = 180      # Phyllotactic angle
h = 1     # height of an internode


Axiom: F!(0.05)F[-(20)FF-(10)A(1)][+(20)FFA(2)]FFFFA(3)

derivation length: 1
production:

A(n):
  produce [^(20)Leaf(scaling)] 
 
interpretation:
Leaf(x) --> ;(2)_(0.05)F(0.1)[+(midrib_separation)Sweep(nerve,section,length,dl,x,width)][-(midrib_separation)Sweep(nerve,section,length,dl,x,width)]

A(n) --> ;(2) @O(0.2)


endlsystem
###### INITIALISATION ######

__lpy_code_version__ = 1.1

def __initialiseContext__(context):
	import openalea.plantgl.all as pgl
	Color_1 = pgl.Material("Color_1" , ambient = (30,60,10) , diffuse = 3 , )
	Color_1.name = "Color_1"
	context.turtle.setMaterial(1,Color_1)
	Color_2 = pgl.Material("Color_2" , ambient = (30,60,10) , diffuse = 0.95 , )
	Color_2.name = "Color_2"
	context.turtle.setMaterial(2,Color_2)
	context.animation_timestep = 1.839
	import openalea.plantgl.all as pgl
	section = pgl.NurbsCurve2D(	
	    ctrlPointList = pgl.Point3Array([(-0.5, 0, 1),(-0.195355, -0.24554, 1),(0.203326, -0.162142, 1),(0.5, 0, 1)]) , 
	    )
	section.name = "section"
	import openalea.plantgl.all as pgl
	width = pgl.NurbsCurve2D(	
	    ctrlPointList = pgl.Point3Array([(0, -0.00416746, 1),(0.341523, 0.0983928, 1),(0.659499, 0.0348646, 1),(1, 0.00418017, 1)]) , 
	    )
	width.name = "width"
	nerve = pgl.NurbsCurve2D(	
	    ctrlPointList = pgl.Point3Array([(-0.5, 0, 1),(-0.223915, 0.114315, 1),(0.121756, 0.0370409, 1),(0.467244, -0.216243, 1)]) , 
	    )
	nerve.name = "nerve"
	panel_0 = ({'name': 'Panel 1', 'active': True, 'visible': True},[('Curve2D',section),('Function',width),('Curve2D',nerve)])
	parameterset = [panel_0,]
	context["__functions__"] = [('width',width),]
	context["__curves__"] = [('section',section),('nerve',nerve),]
	context["__parameterset__"] = parameterset
	context["section"] = section
	context["width"] = pgl.QuantisedFunction(width)
	context["nerve"] = nerve
